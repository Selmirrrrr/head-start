@using HeadStart.Client.Services.Users
@using HeadStart.Client.Themes
@inherits LayoutComponentBase
@implements IDisposable

<PageTitle>Claimly</PageTitle>

<MudThemeProvider Theme="@Theme.ApplicationTheme()" IsDarkMode="@UserState.CurrentState.DarkMode" IsDarkModeChanged="@OnDarkModeChanged" />
<MudPopoverProvider />
<MudSnackbarProvider />
<MudDialogProvider FullWidth="true" MaxWidth="MaxWidth.ExtraSmall" />
@Body

@code{
    [CascadingParameter] public UserStateContainer UserState { get; set; } = null!;

    protected override void OnInitialized()
    {
        UserState.OnStateChanged += OnStateChanged;
    }

    private async Task OnDarkModeChanged(bool isDarkMode)
    {
        await UserState.SetDarkModeAsync(isDarkMode);
    }

    private void OnStateChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        UserState.OnStateChanged -= OnStateChanged;
    }
}
